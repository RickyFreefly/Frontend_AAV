{% extends "base.html" %}

{% block title %}Egresos{% endblock %}

{% block content %}
<div class="dashboard-container">
  <h1>Gestión de Egresos</h1>
  <a href="{{ url_for('dashboard.index') }}" class="btn-volver">⬅️ Volver</a>

  <!-- Tarjeta formulario -->
  <div class="card-form">
    <form method="post" action="{{ url_for('egresos.crear_egreso') }}" class="egreso-form">
      <input type="date" name="fecha" required>
      <input type="text" name="concepto" placeholder="Concepto" required>
      <input type="text" name="proveedor" placeholder="Proveedor" required>
      <input type="number" step="0.01" name="valor" placeholder="Valor" required>
      <select name="metodopago" required>
        <option value="Efectivo">Efectivo</option>
        <option value="Transferencia">Transferencia</option>
        <option value="Tarjeta">Tarjeta</option>
      </select>
      <input type="text" name="observacion" placeholder="Observación">
      <button type="submit" class="btn-agregar">➕ Agregar Egreso</button>
    </form>
  </div>

  <!-- Listado de egresos -->
  <div class="table-responsive">
    <table class="egresos-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Fecha</th>
          <th>Concepto</th>
          <th>Proveedor</th>
          <th>Valor</th>
          <th>Método Pago</th>
          <th>Usuario</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for e in egresos %}
        <tr>
          <td>{{ e.idegreso }}</td>
          <td>{{ e.fecha[:10] }}</td>
          <td><a href="{{ url_for('egresos.detalle_egreso', id=e.idegreso) }}">{{ e.concepto }}</a></td>
          <td>{{ e.proveedor }}</td>
          <td>${{ "%.2f"|format(e.valor|float) }}</td>
          <td>{{ e.metodopago }}</td>
          <td>{{ e.usuario or '—' }}</td>
          <td>
            <span class="badge {{ e.estado|lower if e.estado else 'pendiente' }}">
              {{ e.estado if e.estado else 'PENDIENTE' }}
            </span>
          </td>
          <td>
            <form method="post" action="{{ url_for('egresos.actualizar_estado', id=e.idegreso) }}" class="form-estado">
              <select name="estado" required>
                <option value="PENDIENTE">Pendiente</option>
                <option value="PAGADO">Pagado</option>
                <option value="ANULADO">Anulado</option>
              </select>
              <button type="submit" class="btn-actualizar">Actualizar</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
